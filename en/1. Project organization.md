# 1. Project organization

## Node.js conventions

> **TL;DR**
>
> - Don't reinvent the wheel, if there's an standard, follow it.

## Updated versions

Updated environment and dependencies
- Ubuntu LTS or higher
- Node.js LTS or higher
- Dependencies at latest patch/minor, preferable major

- [ ] Node.js v8.11.1 is not the latest in the v8.x branch, upgrade it
- [ ] Node.js v8.x 'carbon' is in maintenance mode and its end of life is
      scheduled for December 2019. Upgrade to current stable v12.10.0 (will be
      the new LTS in less than a month, October 2019)

- [ ] dependencies are outdated, new versions are
      aws-sdk        ^2.384.0  →  ^2.531.0
      body-parser     ~1.18.2  →   ~1.19.0
      bottleneck      ^2.15.3  →   ^2.19.5
      compression      ^1.7.1  →    ^1.7.4
      config          ^1.30.0  →    ^3.2.2
      cookie-parser    ~1.4.3  →    ~1.4.4
      cors             ^2.8.4  →    ^2.8.5
      debug            ~2.6.9  →    ~4.1.1
      dotenv           ^8.0.0  →    ^8.1.0
      helmet          ^3.10.0  →   ^3.21.0
      jasmine-node    ^1.16.2  →    ^3.0.0
      lodash         ^4.17.11  →  ^4.17.15

## Transpilation

If you are writting your project source code not in javascript but with other
language or using non-standard features, you need transpile (*translate
compile*) with Babel or some other tool to make it executable by Node.js or by
the browser. This includes when you are building a webapp, where you need to
bundle and minify all your javascript and CSS files to get them ready to
publish. The standard way for this is to add a `build` script to `package.json`
file, so it's possible to build them (usually generating code only for
development stage) just by executing `npm run build`.

```sh
# Has package.json file a prepare script?
npm -c "require('package.json').scripts.build != null"
```

One good idea, specially for transpiled libraries, is to build them when
installing from a git repository. This way, in case you need to do some changes
from the original source code (for example, you've found a bug), you can point
your git repository as dependency and its code will be transpiled automatically.
To do so, add a new `prepare` script entry that simply call your build/transpile
script. This has the drawback that you would need to add the build dependencies
in the `dependencies` field, but alternatively you can be able to define them as
`devDependencies` field of the parent project root `package.json` file.

```sh
# Has package.json file a prepare script pointing to build script?
npm -c "require('package.json').scripts.prepare === 'npm run build'"
```

Use the convention folder `src/` to store the original source code needs to be
transpiled with Babel or any other tool. If that's the case, then config your
build scripts to store the transpiled files in a clean `lib/` folder (**never**
mix actual sources with generated code), or if it makes sense for your project
(for example, when it's a collection of components that could be used
independently), then store the transpiled files to the project root and use the
default `index.js` file instead and add the `src/` folder to the `.npmignore`
file to publishhave a clean package.

```sh
# Does code needs transpilation?
npm -c "require('package.json').devDependencies['babel-cli']"

# Does src/ folder exists?
test -d src
```
